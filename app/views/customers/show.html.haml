%title
  Unwinders
  |
  = "#{@customer.name}"
#customer-profile
  - model_class = Customer
  .row
    #profile.span7{:style => 'padding:20px;background:white'}
      %h2 Personal Information
      %ul.account-info
        %li
          %label= model_class.human_attribute_name(:name)
          %span
            &nbsp;
            = best_in_place @customer, :name
        %li
          %label= model_class.human_attribute_name(:address_1)
          %span
            &nbsp;
            = best_in_place @customer, :address_1
        %li
          %label= model_class.human_attribute_name(:address_2)
          %span
            &nbsp;
            = best_in_place @customer, :address_2
        %li
          %label= model_class.human_attribute_name(:city)
          %span
            &nbsp;
            = best_in_place @customer, :city
        %li
          %label= model_class.human_attribute_name(:state)
          %span
            &nbsp;
            = best_in_place @customer, :state
        %li
          %label= model_class.human_attribute_name(:country)
          %span
            &nbsp;
            = best_in_place @customer, :country, type: :select, collection: (ActionView::Helpers::FormOptionsHelper::COUNTRIES.zip(ActionView::Helpers::FormOptionsHelper::COUNTRIES))
        %li
          %label Landline
          %span
            &nbsp;
            = best_in_place @customer, :lphone
        %li
          %label Mobile Number
          %span
            &nbsp;
            = best_in_place @customer, :mphone
      %br
      %div.pull-left
        Click any field to edit
    #wishlist.span4{:style => 'padding:20px;background:white'}
      %h2 Wishlist
      %ul.account-info
        %table.table.table-striped
          - @customer.wish_list_items.each do |wish|
            - destination_object = Destination.find(wish.destination_id)
            %tr
              %td
                .image_holder_small
                  %img{:src => "#{destination_object.image.url(:thumb)}"}
              %td
                = link_to destination_object.name , destination_path(destination_object)
              %td
                .remove
                  = link_to "Remove" , "#" , :wish_list_item_id => wish[:id]
    - if (!(current_user.has_role? :planner) || current_user.vc_registration)
      #role-options.span4{:style => 'padding:20px;background:white'}
        %h2 Control Centre
        - if !(current_user.has_role? :planner) && !current_user.vc_registration
          = link_to "Think you plan well? Sign up as a travel planner on Unwinders!", new_vc_registration_path
        - if current_user.vc_registration
          = link_to "Your application state is - #{current_user.vc_registration.status}", vc_registration_path(current_user.vc_registration)
    %br
    .current_user_requests
      = render :partial => 'current_requests'
    #header-history.span7{:style => 'padding:20px;background:white'}
      %h2 History
      - if !@cust_iti_headers.present?
        .well{:style => 'margin-top:20px;text-align:center'}
          %h3
            No trips to show.
            = link_to "Request", user_unwinders_path
            a package soon!
      - else
        .portfolio
          %ul.grid{:style => 'width:900px'}
            - @cust_iti_headers.each do |h|
              %li
                %a{:href => history_cust_iti_header_path(:id => h.id)}
                  .img-with-text
                    %img{:src => "#{h.cust_iti_details.last.destination.image.url(:square) rescue nil}", :alt => "No image"}
                    %p
                      - last_index = h.cust_iti_details.length - 1
                      - h.cust_iti_details.each_with_index do |d, ind|
                        - unless (ind == last_index)
                          = d.destination.name
                          \-
                        - else
                          = d.destination.name
                      %br
                      = h.trip_start_date.strftime("%d-%m-%y")
                      to
                      = h.trip_end_date.strftime("%d-%m-%y")
